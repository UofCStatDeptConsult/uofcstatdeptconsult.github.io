<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Based on the CME/STATS 195 course at Stanford University by Lan Huong Nguyen" />
  <title>Preprocessing Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="libs/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="libs/reveal.js-3.3.0.1/css/theme/simple.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>

    <link rel="stylesheet" href="cme195.css"/>

<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Preprocessing Data</h1>
    <h2 class="author">Based on the CME/STATS 195 course at Stanford University by Lan Huong Nguyen</h2>
</section>

<section id="contents" class="slide level2">
<h2>Contents</h2>
<div class="center" style="width: 100%">
<p><img src="Lecture5-figure/data-science-explore.png" width="1000"></img></p>
</div>
</section>
<section><section id="data-manipulation" class="title-slide slide level1"><h1>Data Manipulation</h1></section><section id="the-purr-package" class="slide level2">
<h2>The <code>purr</code> package</h2>
<p>Package <code>purrr</code> is part of the <code>tidyverse</code>. Handles tasks similar to ones performed by apply-family functions in base R.</p>
<p>It enhances R’s functional programming toolkit by providing a complete and consistent set of tools for working with functions and vectors. <code>map</code>-functions allow you to replace many for loops with code that is easier to read.</p>
<ul>
<li><code>map()</code>, <code>map_if()</code>, <code>map_at()</code> returns a list</li>
<li><code>map_lgl()</code> returns a logical vector,</li>
<li><code>map_int()</code> returns a integer vector,</li>
<li><code>map_dbl()</code> returns a double vector,</li>
<li><code>map_chr()</code> returns a character vector,</li>
<li><code>map_dfr()</code>, <code>map_dfc()</code> returns a <code>data.frame</code><br />
by binding rows or columns respectively.</li>
</ul>
</section><section id="the-map-functions" class="slide level2">
<h2>The map functions</h2>
<p>Example: column-wise mean</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">a=</span><span class="kw">rnorm</span>(<span class="dv">10</span>), <span class="dt">b=</span><span class="kw">rnorm</span>(<span class="dv">10</span>), <span class="dt">c=</span><span class="kw">rnorm</span>(<span class="dv">10</span>), <span class="dt">d=</span><span class="kw">rnorm</span>(<span class="dv">10</span>))</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">map_dbl</span>(df, mean)                       <span class="co"># or equivalently: df %&gt;% map_dbl(mean)   </span></span></code></pre></div>
<pre><code>##           a           b           c           d 
## -0.13974615 -0.00109374 -0.25522181  0.08444362</code></pre>
<p>Focus is on the operation being performed, not the book-keeping:</p>
<ul>
<li><code>purrr</code> functions are implemented in C.</li>
<li>the second argument, <code>.f</code>, can be a functions, a formula, a character vector, or an integer vector.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">7</span>, .x))</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.8987621 2.5514663 1.0562170 1.1556593 1.9476478 1.1873044 0.5633830
## 
## [[2]]
## [1] 1.1506502 2.1376553 1.1603602 1.8429223 1.2180598 0.3672492 1.2454315
## 
## [[3]]
## [1] 3.705864 2.477710 2.741575 2.241135 1.545757 3.063516 2.522218</code></pre>
</section><section id="the-map-functions-2" class="slide level2">
<h2>The map functions (2)</h2>
<ul>
<li><code>map</code> can pass additional parameters to the function</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">map_dbl</span>(df, mean, <span class="dt">trim =</span> <span class="fl">0.25</span>)</span></code></pre></div>
<pre><code>##           a           b           c           d 
## -0.28262161 -0.04795064 -0.30965646  0.06082694</code></pre>
<ul>
<li>other inputs/outputs:</li>
</ul>
<div class="left" style="width: 50%">
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>mtcars <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw">split</span>(.<span class="op">$</span>cyl)</span></code></pre></div>
<pre><code>## $`4`
##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Merc 240D      24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230       22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona  21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
## 
## $`6`
##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## 
## $`8`
##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8</code></pre>
</div>
<div class="right" style="width: 50%">
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>mtcars <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span><span class="kw">split</span>(.<span class="op">$</span>cyl) <span class="op">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">  </span><span class="kw">map_df</span>(dim)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     `4`   `6`   `8`
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1    11     7    14
## 2    11    11    11</code></pre>
</div>
</section><section id="base-r-maps-vs.-purrr-maps" class="slide level2">
<h2>Base-R maps vs. purrr maps</h2>
<p>However, <code>purrr</code> is more consistent, so you should learn it.</p>
<p>A quick reference of similar base R functions:</p>
<ul>
<li><p>lapply is basically identical to map</p></li>
<li><p>sapply is a wrapper around lapply and it tries to simplify the output. Downside: you never know what you’ll get</p></li>
<li><p>vapply: like sapply, but you can supply an additional argument that defines the type</p></li>
</ul>
<p>You can learn more about purr here: (<a href="http://r4ds.had.co.nz/iteration.html" class="uri">http://r4ds.had.co.nz/iteration.html</a>)</p>
</section></section>
<section><section id="handling-missing-values" class="title-slide slide level1"><h1>Handling missing values</h1></section><section id="missing-values" class="slide level2">
<h2>Missing values</h2>
<p>Two types of missingness</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>stocks &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="dt">year   =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2016</span>, <span class="dv">2016</span>),</span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="dt">qtr    =</span> <span class="kw">c</span>(   <span class="dv">1</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>),</span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="dt">return =</span> <span class="kw">c</span>(<span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.35</span>,   <span class="ot">NA</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>, <span class="fl">2.66</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>)</span></code></pre></div>
<p>The return for the fourth quarter of 2015 is <strong>explicitly missing</strong></p>
<p>The return for the first quarter of 2016 is <strong>implicitly missing</strong></p>
<p>The way that a dataset is represented can make implicit values explicit.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(year, return)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     qtr `2015` `2016`
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1   1.88  NA   
## 2     2   0.59   0.92
## 3     3   0.35   0.17
## 4     4  NA      2.66</code></pre>
</section><section id="gathering-missing-data" class="slide level2">
<h2>Gathering missing data</h2>
<p>Recall the functions we learned from <code>tidyr</code> package.</p>
<p>You can used <code>spread()</code> and <code>gather()</code> to retain only non-missing recored, i.e. to turn all explicit missing values into implicit ones.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">gather</span>(year, return, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##     qtr year  return
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1     1 2015    1.88
## 2     2 2015    0.59
## 3     3 2015    0.35
## 4     2 2016    0.92
## 5     3 2016    0.17
## 6     4 2016    2.66</code></pre>
</section><section id="completing-missing-data" class="slide level2">
<h2>Completing missing data</h2>
<p><code>complete()</code> takes a set of columns, and finds all unique combinations. It then ensures the original dataset contains all those values, <strong>filling in explicit <code>NA</code>s</strong> where necessary.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">complete</span>(year, qtr)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##    year   qtr return
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  2015     1   1.88
## 2  2015     2   0.59
## 3  2015     3   0.35
## 4  2015     4  NA   
## 5  2016     1  NA   
## 6  2016     2   0.92
## 7  2016     3   0.17
## 8  2016     4   2.66</code></pre>
</section><section id="different-intepretations-of-na" class="slide level2">
<h2>Different intepretations of <code>NA</code></h2>
<p>Sometimes when a data source has primarily been used for data entry, missing values indicate that the previous value should be carried forward:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># tribble() constructs a tibble by filling by rows</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>treatment &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="op">~</span><span class="st"> </span>person,           <span class="op">~</span><span class="st"> </span>treatment, <span class="op">~</span>response,</span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="st">&quot;Derrick Whitmore&quot;</span>, <span class="dv">1</span>,           <span class="dv">7</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="ot">NA</span>,                 <span class="dv">2</span>,           <span class="dv">10</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="ot">NA</span>,                 <span class="dv">3</span>,           <span class="dv">9</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="st">&quot;Katherine Burke&quot;</span>,  <span class="dv">1</span>,           <span class="dv">4</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>)</span></code></pre></div>
<p>You can fill in these missing values with <code>fill()</code></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>treatment <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fill</span>(person)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   person           treatment response
##   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
## 1 Derrick Whitmore         1        7
## 2 Derrick Whitmore         2       10
## 3 Derrick Whitmore         3        9
## 4 Katherine Burke          1        4</code></pre>
</section></section>
<section><section id="merging-datasets" class="title-slide slide level1"><h1>Merging datasets</h1></section><section id="relational-data" class="slide level2">
<h2>Relational data</h2>
<ul>
<li><p>Rarely does a data analysis involve only a single table of data.</p></li>
<li><p>Collectively, multiple tables of data are called <strong>relational data</strong> because the relations, not just the individual datasets, that are important.</p></li>
<li><p>Relations are always defined between a pair of tables.</p></li>
<li><p>All other relations are built up from this simple idea: the relations of three or more tables are always a property of the relations between each pair.</p></li>
</ul>
</section><section id="example" class="slide level2">
<h2>Example</h2>
<p>the <code>nycflights13</code> package contains a collection of related datasets.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">library</span>(nycflights13)</span></code></pre></div>
<p><img data-src="Lecture5-figure/nycflights13.png" /></p>
<p>Source: (<a href="http://r4ds.had.co.nz/relational-data.html" class="uri">http://r4ds.had.co.nz/relational-data.html</a>)</p>
</section><section id="keys" class="slide level2">
<h2>Keys</h2>
<p><strong>A key</strong> is a variable (or set of variables) that uniquely identifies an observation.</p>
<p><em>For example, each plane is uniquely determined by its tailnum, but an observation in ‘weather’ is identified by five variables: <code>year, month, day</code>, <code>hour, and origin</code></em></p>
<p><strong>Keys</strong> can be used to connect each pair of tables together.</p>
<p>There are two types of keys:</p>
<ul>
<li><p><strong>Primary:</strong> identifies an observation in its own table. Example: <code>planes$tailnum</code></p></li>
<li><p><strong>Foreign:</strong> identifies an observation in another table. Example: <code>flights$tailnum</code>, this is because <code>tailnum</code> does not enough to identify a record in <code>flights</code> dataset.</p></li>
</ul>
<p>A variable can be both a primary key and a foreign key.</p>
</section><section id="identify-primary-keys" class="slide level2">
<h2>Identify primary keys</h2>
<p>It’s good practice to verify that chosen keys do indeed uniquely identify each observation.</p>
<p>One way to do that is to <code>count()</code> the primary keys and look for entries where <code>n</code> is greater than one:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>planes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span><span class="kw">count</span>(tailnum) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 x 2
## # … with 2 variables: tailnum &lt;chr&gt;, n &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>weather <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="st">  </span><span class="kw">count</span>(year, month, day, hour, origin) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##    year month   day  hour origin     n
##   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt;
## 1  2013    11     3     1 EWR        2
## 2  2013    11     3     1 JFK        2
## 3  2013    11     3     1 LGA        2</code></pre>
</section><section id="no-primary-key" class="slide level2">
<h2>No primary key</h2>
<p>Sometimes a table doesn’t have an explicit primary key, e.g.  in <code>flights</code> dataset each row is an observation, but no combination of variables reliably identifies it, (even the flight numbers).</p>
<p>In this case, you can add an extra <code>identifier</code> column:</p>
<div class="left" style="width: 50%">
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="st">  </span><span class="kw">count</span>(flight) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) </span></code></pre></div>
<pre><code>## # A tibble: 3,493 x 2
##    flight     n
##     &lt;int&gt; &lt;int&gt;
##  1      1   701
##  2      2    51
##  3      3   631
##  4      4   393
##  5      5   324
##  6      6   210
##  7      7   237
##  8      8   236
##  9      9   153
## 10     10    61
## # … with 3,483 more rows</code></pre>
</div>
<div class="right" style="width: 50%">
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">flight_id=</span> <span class="kw">paste0</span>(<span class="st">&quot;F&quot;</span>, <span class="kw">row_number</span>())) <span class="op">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="st">  </span><span class="kw">select</span>(flight_id, year<span class="op">:</span>flight)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 12
##    flight_id  year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;chr&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1 F1         2013     1     1      517            515         2      830
##  2 F2         2013     1     1      533            529         4      850
##  3 F3         2013     1     1      542            540         2      923
##  4 F4         2013     1     1      544            545        -1     1004
##  5 F5         2013     1     1      554            600        -6      812
##  6 F6         2013     1     1      554            558        -4      740
##  7 F7         2013     1     1      555            600        -5      913
##  8 F8         2013     1     1      557            600        -3      709
##  9 F9         2013     1     1      557            600        -3      838
## 10 F10        2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 4 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;</code></pre>
</div>
</section><section id="merging-two-tables" class="slide level2">
<h2>Merging two tables</h2>
<p>There are three families of functions designed to merge relational data:</p>
<ul>
<li><p><strong>Mutating joins</strong>, which add new variables to one data frame from matching observations in another.</p></li>
<li><p><strong>Filtering joins</strong>, which filter observations from one data frame based on whether or not they match an observation in the other table.</p></li>
<li><p><strong>Set operations</strong>, which treat observations as if they were set elements.</p></li>
</ul>
</section><section id="mutating-joins" class="slide level2">
<h2>Mutating joins</h2>
<p><strong>A mutating join</strong> allows you to combine variables from two tables, by matching observations by their keys, and then copying across variables from one table to the other. e.g.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest, tailnum, carrier) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by =</span> <span class="st">&quot;carrier&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 9
##     year month   day  hour origin dest  tailnum carrier name                    
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
##  1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
##  2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
##  3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
##  4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
##  5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
##  6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
##  7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
##  8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
##  9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
## # … with 336,766 more rows</code></pre>
</section><section id="mutating-joins-1" class="slide level2">
<h2>Mutating joins</h2>
<p>There are four mutating join functions:</p>
<ul>
<li><p><code>inner_join()</code></p></li>
<li><p>outer joins;</p>
<ul>
<li><code>left_join()</code></li>
<li><code>right_join()</code></li>
<li><code>full_join()</code></li>
</ul></li>
</ul>
</section><section id="a-simple-example" class="slide level2">
<h2>A simple example</h2>
<div class="left" style="width: 50%">
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>x &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="op">~</span>key, <span class="op">~</span>val_x,</span>
<span id="cb32-3"><a href="#cb32-3"></a>     <span class="dv">1</span>, <span class="st">&quot;x1&quot;</span>,</span>
<span id="cb32-4"><a href="#cb32-4"></a>     <span class="dv">2</span>, <span class="st">&quot;x2&quot;</span>,</span>
<span id="cb32-5"><a href="#cb32-5"></a>     <span class="dv">3</span>, <span class="st">&quot;x3&quot;</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>)</span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a>y &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb32-9"><a href="#cb32-9"></a>  <span class="op">~</span>key, <span class="op">~</span>val_y,</span>
<span id="cb32-10"><a href="#cb32-10"></a>     <span class="dv">1</span>, <span class="st">&quot;y1&quot;</span>,</span>
<span id="cb32-11"><a href="#cb32-11"></a>     <span class="dv">2</span>, <span class="st">&quot;y2&quot;</span>,</span>
<span id="cb32-12"><a href="#cb32-12"></a>     <span class="dv">4</span>, <span class="st">&quot;y3&quot;</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>)</span></code></pre></div>
</div>
<div class="right" style="width: 50%">
<p><img data-src="Lecture5-figure/join-setup.png" /> <img data-src="Lecture5-figure/join-setup2.png" /></p>
</div>
</section><section id="inner-join" class="slide level2">
<h2>Inner join</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     key val_x val_y
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1     1 x1    y1   
## 2     2 x2    y2</code></pre>
<p><img data-src="Lecture5-figure/join-inner.png" /> Source: (<a href="http://r4ds.had.co.nz/relational-data.html" class="uri">http://r4ds.had.co.nz/relational-data.html</a>)</p>
</section><section id="outer-join" class="slide level2">
<h2>Outer join</h2>
<div class="left" style="width: 50%">
<p>An outer join keeps observations that appear in at least one of the tables:</p>
<ul>
<li><p>A <code>left_join()</code> keeps all observations in the table on the left</p></li>
<li><p>A <code>right_join()</code> keeps all observations in the table on the right</p></li>
<li><p>A <code>full_join()</code> keeps all observations in both tables</p></li>
</ul>
<p></br></p>
<p><small2>Source: <a href="http://r4ds.had.co.nz/relational-data.html" class="uri">http://r4ds.had.co.nz/relational-data.html</a></small2></p>
</div>
<div class="right" style="width: 50%">
<p>&lt;img src=“./Lecture5-figure/join-outer.png”, height=“750”&gt;</img></p>
</div>
</section><section id="duplicate-keys" class="slide level2">
<h2>Duplicate keys</h2>
<p>What happens when there are duplicate keys?</p>
<ul>
<li><p>One table has duplicate keys. There may be a one-to-many relation. &lt;img src=“./Lecture5-figure/join-one-to-many.png”, height=“200”&gt;</img></p></li>
<li><p>Both tables have duplicate keys. When you join duplicated keys, you get all possible combinations: &lt;img src=“./Lecture5-figure/join-many-to-many.png”, height=“250”&gt;</img></p></li>
</ul>
<p><small2>Source: <a href="http://r4ds.had.co.nz/relational-data.html" class="uri">http://r4ds.had.co.nz/relational-data.html</a></small2></p>
</section><section id="filtering-joins" class="slide level2">
<h2>Filtering joins</h2>
<p>Filtering joins match observations in the same way as mutating joins, but affect the observations, not the variables.</p>
<p>There are two types:</p>
<ul>
<li><code>semi_join(x, y)</code> keeps all observations in x that have a match in y.</li>
<li><code>anti_join(x, y)</code> drops all observations in x that have a match in y.</li>
</ul>
<div class="left" style="width: 50%">
<p><img data-src="Lecture5-figure/join-semi.png" /></p>
</div>
<div class="right" style="width: 50%">
<p><img data-src="Lecture5-figure/join-anti.png" /></p>
</div>
</section><section id="multiple-matches" class="slide level2">
<h2>Multiple matches</h2>
<p>In filtering joins, only the existence of a match is important.</p>
<p>It doesn’t matter which observation is matched.</p>
<p>Filtering joins never duplicate rows like mutating joins do:</p>
<p><img data-src="Lecture5-figure/join-semi-many.png" /></p>
</section><section id="set-operations" class="slide level2">
<h2>Set operations</h2>
<p>Set operations apply to rows; they expect the <code>x</code> and <code>y</code> inputs to have the same variables, and treat the observations like sets.</p>
<ul>
<li><p><code>intersect(x, y)</code>: returns only observations in both x and y.</p></li>
<li><p><code>union(x, y)</code>: returns unique observations in x and y.</p></li>
<li><p><code>setdiff(x, y)</code>: returns observations in x, but not in y.</p></li>
</ul>
<p>All these operations work with a complete row, comparing the values of every variable.</p>
</section><section id="example-1" class="slide level2">
<h2>Example</h2>
<div class="left" style="width: 50%">
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="op">~</span>x, <span class="op">~</span>y,</span>
<span id="cb35-3"><a href="#cb35-3"></a>   <span class="dv">1</span>,  <span class="dv">1</span>,</span>
<span id="cb35-4"><a href="#cb35-4"></a>   <span class="dv">2</span>,  <span class="dv">1</span></span>
<span id="cb35-5"><a href="#cb35-5"></a>)</span>
<span id="cb35-6"><a href="#cb35-6"></a>df2 &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="op">~</span>x, <span class="op">~</span>y,</span>
<span id="cb35-8"><a href="#cb35-8"></a>   <span class="dv">1</span>,  <span class="dv">1</span>,</span>
<span id="cb35-9"><a href="#cb35-9"></a>   <span class="dv">1</span>,  <span class="dv">2</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">intersect</span>(df1, df2)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1</code></pre>
</div>
<div class="right" style="width: 50%">
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">union</span>(df1, df2)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1
## 2     2     1
## 3     1     2</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">setdiff</span>(df1, df2)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     2     1</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">setdiff</span>(df2, df1)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2</code></pre>
</div>
</section></section>
<section><section id="data-export" class="title-slide slide level1"><h1>Data Export</h1></section><section id="exporting-data" class="slide level2">
<h2>Exporting Data</h2>
<p>After working with a dataset and doing all data manipulation, you might want to save your new data table.</p>
<p>Recall the <code>readr</code> package. Besides functions for reading data in, <code>readr</code> has utilities for <strong>saving your data to a text file</strong>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw">write_tsv</span>(mydata, <span class="st">&quot;path/to/filename.tsv&quot;</span>)                  <span class="co"># tab-delimited</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="kw">write_csv</span>(mydata, <span class="st">&quot;path/to/filename.csv&quot;</span>)                  <span class="co"># comma-delimited</span></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="kw">write_delim</span>(mydata, <span class="st">&quot;path/to/filename.csv&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot; &quot;</span>)   <span class="co"># general delimiter</span></span></code></pre></div>
<p>To save your data in other types of files, you need to install and use other packages:</p>
<ul>
<li>to export an <strong>Excel spreadsheet</strong>, use <code>xlsx</code> package, and follow this <a href="http://www.sthda.com/english/wiki/r-xlsx-package-a-quick-start-guide-to-manipulate-excel-files-in-r">guide</a>.</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># install.packages(xlsx)</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="kw">library</span>(xlsx)</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="kw">write.xlsx</span>(mydata, <span class="st">&quot;path/to/filename.xlsx&quot;</span>)</span></code></pre></div>
<ul>
<li>to export <strong>SAS</strong>, <strong>SPSS</strong> and <strong>Stata</strong> files use the <a href="https://haven.tidyverse.org/"><code>haven</code> package</a>.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># install.packages(haven)</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="kw">library</span>(haven)</span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="kw">read_sas</span>(<span class="st">&quot;mtcars.sas7bdat&quot;</span>)</span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="kw">write_sas</span>(mtcars, <span class="st">&quot;mtcars.sas7bdat&quot;</span>)</span></code></pre></div>
</section><section id="saving-the-workspace" class="slide level2">
<h2>Saving the workspace</h2>
<ul>
<li><p>You can also choose to <strong>save all objects</strong> currently in the workspace (variables, functions, etc.) into a file e.g. <code>filename.rda</code>.</p></li>
<li><p>The file <code>filename.rda</code> can be the easily loaded next time you work with R.</p></li>
<li><p>You can also save a single object or a subset of specified objects currently in the workspace.</p></li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># save the workspace to file </span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="kw">save.image</span>(<span class="dt">file =</span> <span class="st">&quot;path/to/filename.rda&quot;</span>)</span>
<span id="cb47-3"><a href="#cb47-3"></a></span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="co"># save specific objects to a file</span></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="kw">save</span>(object_list, <span class="dt">file =</span> <span class="st">&quot;path/to/filename.rda&quot;</span>)</span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a><span class="co"># save just a single object</span></span>
<span id="cb47-8"><a href="#cb47-8"></a><span class="kw">saveRDS</span>(object, <span class="dt">file =</span> <span class="st">&quot;path/to/filename.rds&quot;</span>)</span></code></pre></div>
<ul>
<li>Saved objects/workspace can be loaded back in a new R session.</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># load a workspace into the current session</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="kw">load</span>(<span class="st">&quot;path/to/filename.rda&quot;</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="co"># read just the previously saved 1 object</span></span>
<span id="cb48-5"><a href="#cb48-5"></a>object &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;path/to/filename.rds&quot;</span>)</span></code></pre></div>
</section></section>
    </div>
  </div>

  <script src="libs/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="libs/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: true,
        // Transition style
        transition: 'slide', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom



        // Optional reveal.js plugins
        dependencies: [
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
